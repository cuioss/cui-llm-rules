= Java Test Maintenance Process
:toc:
:toclevels: 2
:sectnums:

[IMPORTANT]
====
This document is governed by the general process rules defined in <<general.adoc#,General Process Rules>>.
====

Process for maintaining and improving Java test quality while preserving functionality and adhering to CUI standards.

== Pre-Maintenance Checklist

Execute before starting test maintenance following <<task-completion-standards.adoc#,Task Completion Standards>>:

1. [ ] *Build Verification*: `./mvnw -Ppre-commit clean verify -DskipTests`
2. [ ] *Test Execution*: `./mvnw clean test` - all tests must pass
3. [ ] *Coverage Baseline*: `./mvnw clean verify -Pcoverage` - record current metrics
4. [ ] *Module Identification*: List all modules for systematic processing

== Module-by-Module Approach

=== Single Module Process
1. *Module Focus*: Process one module completely before moving to next
2. *Test Execution*: `./mvnw clean test -pl module-name`
3. *Coverage Check*: `./mvnw clean verify -Pcoverage -pl module-name`
4. *Commit per Module*: Complete module before next following <<git-commit-standards.adoc#,Git Commit Standards>>

=== Multi-Module Strategy
* Process modules in dependency order (dependencies first)
* Maintain build stability after each module
* Verify inter-module test compatibility

== Test Quality Issues

=== AI-Generated Code Detection
* **Detection Process**: Identify AI artifacts per <<../testing/quality-standards.adoc#ai-generated-code-detection,Quality Standards AI Detection>>
* **Removal Actions**: Apply removal rules as defined in quality standards
* **Process Focus**: Systematic identification and elimination during maintenance cycles

=== Duplicate Detection
* **Identical Test Logic**: Consolidate into parameterized tests using JUnit 5 with @GeneratorsSource
* **Similar Test Data**: Extract to shared TypeGenerator implementations
* **Repeated Setup**: Move to `@BeforeEach` or test base classes
* **Copy-Paste Patterns**: Refactor into reusable test methods with generator support
* **Manual Data Duplication**: Replace with consistent generator-based data creation

== CUI Framework Compliance

=== Framework Compliance Requirements

* **Apply Standards**: Follow <<../testing/core-standards.adoc#cui-framework-requirements,CUI Framework Requirements>>
* **Library Restrictions**: Adhere to <<../testing/quality-standards.adoc#testing-library-restrictions,Testing Library Requirements>>
* **Implementation Guide**: Reference <<../testing/cui-test-generator-guide.adoc#,CUI Test Generator Guide>> for examples

=== Framework Migration Process

1. **Scan for Issues**: Identify violations of CUI framework requirements
2. **Apply Standards**: Follow migration patterns per framework standards
3. **Verify Compliance**: Check against CUI framework requirements
4. **Update Implementation**: Use generator guide examples for correct patterns

== Maintenance Standards

=== Test Structure
Following <<../testing/core-standards.adoc#,Core Standards>>:
* Verify AAA pattern (Arrange-Act-Assert)
* Ensure test independence
* Confirm descriptive test names
* Check proper `@DisplayName` usage

=== Coverage Requirements
* Maintain minimum 80% line coverage
* Preserve existing coverage levels
* Identify untested critical paths
* Document coverage gaps

== Critical Constraints

=== Production Code Protection
* **NO PRODUCTION CHANGES** except confirmed bugs
* **Bug Discovery**: Must ask user for approval before fixing production code
* **Test-Only Changes**: Focus solely on test improvement
* **Behavior Preservation**: All existing tests must continue to pass

=== Bug Handling Process
When production bugs are discovered:
1. **Stop maintenance process**
2. **Document bug details** (location, issue, impact)
3. **Ask user for approval** to fix production code
4. **Wait for confirmation** before proceeding
5. **Create separate commit** for bug fix following <<git-commit-standards.adoc#,Git Commit Standards>>

== Maintenance Workflow

=== Analysis Phase
1. **Scan for Issues**: Identify AI artifacts, duplicates, and non-compliance
2. **AI Pattern Detection**: Check for method names >75 chars, excessive comments, verbose @DisplayName
3. **Non-Sensible Test Review**: Identify meaningless constructor tests and framework behavior tests
4. **CUI Framework Audit**: Check for manual data creation and missing annotations
5. **Value Object Review**: Identify objects needing contract testing
6. **Prioritize Changes**: Focus on high-impact improvements first
7. **Plan Module Order**: Dependencies first, then dependent modules

=== Compliance Verification Checklist
For each test class, verify compliance with:
- [ ] **CUI Framework Standards**: <<../testing/core-standards.adoc#cui-framework-requirements,Framework Requirements>>
- [ ] **Quality Standards**: <<../testing/quality-standards.adoc#ai-generated-code-detection,AI Detection>> and <<../testing/quality-standards.adoc#testing-library-restrictions,Library Restrictions>>
- [ ] **Coverage Requirements**: <<../testing/quality-standards.adoc#coverage-requirements,Coverage Standards>>

=== Implementation Phase
1. **Apply Changes**: Fix one category of issues at a time
2. **Verify Tests**: `./mvnw clean test -pl module-name` after each change
3. **Check Coverage**: Ensure no coverage regression
4. **Commit Incrementally**: Small, focused commits per improvement type

=== Verification Phase
Following <<task-completion-standards.adoc#,Task Completion Standards>>:
1. **Full Build**: `./mvnw -Ppre-commit clean verify -DskipTests`
2. **Complete Test Suite**: `./mvnw clean install`
3. **Coverage Verification**: `./mvnw clean verify -Pcoverage`
4. **Final Commit**: Consolidate if needed, update module status

== Common Improvements

=== Test Simplification Process
* **Apply AI artifact removal** per <<../testing/quality-standards.adoc#ai-generated-code-detection,Quality Standards>>
* **Remove non-sensible tests** per quality standards criteria
* **Refactor complex test logic** to follow AAA pattern per <<../testing/core-standards.adoc#,Core Standards>>
* **Extract repeated test data** to TypeGenerator implementations
* **Convert similar tests** to parameterized tests using @GeneratorsSource
* **Fix compliance violations** per <<../testing/quality-standards.adoc#sonarqube-compliance,SonarQube Standards>>

=== Framework Migration Process

**Migration Steps:**
1. **Identify Violations**: Scan for manual data creation, hardcoded values, non-CUI frameworks
2. **Apply Standards**: Follow patterns per <<../testing/cui-test-generator-guide.adoc#,CUI Test Generator Guide>>
3. **Verify Compliance**: Check against <<../testing/quality-standards.adoc#cui-testing-utilities,CUI Testing Standards>>
4. **Test Execution**: Ensure all tests pass after migration

=== Value Object Testing Process

**Implementation Steps:**
1. **Identify Value Objects**: Locate classes requiring contract testing
2. **Apply Standards**: Follow patterns per <<../testing/cui-test-generator-guide.adoc#,CUI Test Generator Guide>>
3. **Verify Coverage**: Ensure equals(), hashCode(), toString(), and Serializable contracts are tested
4. **Generator Integration**: Use cui-test-generator for all test data creation

=== Structure Optimization
* Group related tests in inner classes
* Extract common setup to base classes  
* Simplify test resource management
* Improve test readability

For complete quality verification, see <<task-completion-standards.adoc#,Task Completion Standards>>.
