= JavaScript Code Maintenance Process
:toc: left
:toclevels: 3
:toc-title: Table of Contents
:sectnums:
:source-highlighter: highlight.js

[IMPORTANT]
====
This document is governed by the general process rules defined in xref:general.adoc[General Process Rules].
====

== Purpose

This document defines the comprehensive process for maintaining and refactoring JavaScript production code to enforce all aspects of the xref:../javascript/javascript-development-standards.adoc[JavaScript Development Standards]. It provides systematic approaches for identifying, prioritizing, and resolving code quality issues while preserving functionality and ensuring long-term maintainability.

== Related Documentation

* xref:../javascript/javascript-development-standards.adoc[JavaScript Development Standards] - Comprehensive JavaScript coding standards
* xref:../javascript/javascript-core-patterns.adoc[JavaScript Core Patterns] - Core language patterns including vanilla JS preference
* xref:../javascript/javascript-best-practices.adoc[JavaScript Best Practices] - Modern JavaScript patterns and conventions
* xref:../javascript/jsdoc-standards.adoc[JSDoc Standards] - Documentation requirements for JavaScript code
* xref:../javascript/linting-standards.adoc[Linting Standards] - ESLint configuration and rules
* xref:task-completion-standards.adoc[Task Completion Standards] - Quality verification processes
* xref:git-commit-standards.adoc[Git Commit Standards] - Standardized commit messaging
* xref:general.adoc[General Process Rules] - Overarching process governance

== Pre-Maintenance Checklist

**Requirements**: Execute the following verification steps before starting code maintenance, following xref:task-completion-standards.adoc[Task Completion Standards]:

1. [ ] **Build Verification**: `npm run build` (if applicable)
2. [ ] **Test Execution**: `npm test` - all tests must pass
3. [ ] **Coverage Baseline**: `npm run test:coverage` - record current metrics
4. [ ] **Lint Check**: `npm run lint` - record existing violations
5. [ ] **Dependency Audit**: `npm audit` - document security vulnerabilities
6. [ ] **Module Identification**: List all JavaScript modules/components for systematic processing

== Module-by-Module Approach

**Strategy**: Process modules systematically to maintain functionality and ensure comprehensive coverage.

=== Single Module Process

**Requirements**: Complete each module entirely before proceeding to the next:

1. **Module Focus**: Process one module/component completely before moving to next
2. **Format Verification**: `npm run format:check`
3. **Lint Verification**: `npm run lint:js`
4. **Test Execution**: Run relevant tests for the module
5. **Coverage Check**: Verify no coverage regression
6. **Commit per Module**: Complete module before next following xref:git-commit-standards.adoc[Git Commit Standards]

=== Multi-Module Strategy

**Dependencies Management**:

* Process modules in dependency order (dependencies first)
* Maintain functionality after each module
* Verify inter-module compatibility after refactoring

== Standards Violation Detection

**Overview**: This section defines when and how to identify violations of xref:../javascript/javascript-development-standards.adoc[JavaScript Development Standards] and what actions to take for each violation type.

=== When to Enforce Vanilla JavaScript Usage

**Triggers for Action**: Apply vanilla JavaScript refactoring when:

* **jQuery/Cash Usage Detected**: Legacy library usage for simple operations
  - **Action Required**: Replace with native JavaScript per xref:../javascript/javascript-core-patterns.adoc#critical-rule-vanilla-javascript-preference[Vanilla JavaScript Preference]
  - **Examples**: 
    * Replace `$.ajax()` with `fetch()`
    * Replace `$('.selector')` with `document.querySelector()`
    * Replace `$.each()` with `Array.forEach()`

* **Unnecessary Library Dependencies**: Libraries used for features available natively
  - **Action Required**: Remove dependency and use native alternatives
  - **Common Replacements**:
    * Lodash array methods → Native array methods
    * Moment.js → Native Date or date-fns
    * Request libraries → Native fetch API

* **Complex Implementation Threshold**: Only keep libraries when vanilla JS would be overly complex
  - **Evaluation Criteria**: More than 50 lines of custom code vs 5-10 lines with library
  - **Action Required**: Document justification for library retention

=== When to Remove Test/Mock Code from Production

**Triggers for Action**: Apply test code removal when:

* **Test-Specific Imports**: Mock libraries or test utilities imported in production code
  - **Action Required**: Remove all test-specific imports and code
  - **Common Violations**:
    * `import { jest } from '@jest/globals'` in production files
    * Mock implementations left in production code
    * Test helper functions in production modules

* **Conditional Test Logic**: `if (process.env.NODE_ENV === 'test')` blocks
  - **Action Required**: Extract test-specific behavior to test files
  - **Refactoring**: Use dependency injection or configuration patterns

* **Development-Only Code**: Debug statements, console logs, or development helpers
  - **Action Required**: Remove or properly guard with build-time conditions
  - **Exception**: Legitimate debug modes with proper configuration

=== When to Improve Modularization

**Triggers for Action**: Apply modularization improvements when:

* **Large Monolithic Files**: Files exceeding 300-400 lines
  - **Action Required**: Split into focused modules per xref:../javascript/javascript-best-practices.adoc[JavaScript Best Practices]
  - **Target**: Single responsibility per module

* **Mixed Concerns**: UI logic mixed with business logic or data fetching
  - **Action Required**: Separate concerns into distinct modules
  - **Pattern**: Model-View-Controller or similar separation

* **Duplicate Code Blocks**: Same logic repeated across files
  - **Action Required**: Extract to shared utilities
  - **Threshold**: Duplication of 10+ lines or complex logic
  - **Exception**: Simple 1-5 line patterns that would overcomplicate if extracted

* **Over-Modularization**: Excessive splitting for trivial functionality
  - **Warning Signs**: 
    * Modules with single 1-5 line functions
    * More import statements than actual code
    * Circular dependency patterns emerging
  - **Action Required**: Consolidate related simple functions

=== When to Update Package.json

**Triggers for Action**: Apply package.json updates when:

* **Outdated Dependencies**: Dependencies with newer stable versions available
  - **Action Required**: Update to latest stable versions
  - **Process**: 
    1. Run `npm outdated` to identify updates
    2. Update dependencies incrementally
    3. Run `npm audit` after each update
    4. Test thoroughly after updates

* **Security Vulnerabilities**: `npm audit` reports vulnerabilities
  - **Action Required**: Fix all critical and high vulnerabilities immediately
  - **Process**: 
    1. Run `npm audit fix` for automatic fixes
    2. Manually update packages for remaining issues
    3. Document any unresolvable vulnerabilities with justification

* **Unused Dependencies**: Packages listed but not imported anywhere
  - **Action Required**: Remove after verification
  - **Detection**: Use `depcheck` or similar tools
  - **Verification**: Ensure no dynamic imports or build tool usage

* **Missing Scripts**: Standard scripts not defined
  - **Action Required**: Add required scripts per xref:../javascript/javascript-development-standards.adoc#javascript-specific-scripts[JavaScript-Specific Scripts]
  - **Required**: test, lint, format, build scripts

* **Incorrect Dependency Types**: Dependencies in wrong section
  - **Action Required**: Move devDependencies vs dependencies correctly
  - **Rule**: Runtime dependencies in `dependencies`, build/test tools in `devDependencies`

=== When to Fix JSDoc and Comments

**Triggers for Action**: Apply documentation fixes when:

* **Missing JSDoc**: Public functions without JSDoc comments
  - **Action Required**: Add JSDoc per xref:../javascript/jsdoc-standards.adoc[JSDoc Standards]
  - **Required Elements**: Description, @param, @returns, @throws

* **Trivial Comments**: Comments stating the obvious
  - **Action Required**: Remove redundant comments
  - **Examples to Remove**:
    ```javascript
    // Set the name
    this.name = name;
    
    // Increment counter by 1
    counter++;
    ```

* **Standard Field Comments**: Comments on common patterns
  - **Action Required**: Remove comments on standard fields
  - **Examples**: Logger instances, common event handlers, standard getters/setters

* **Outdated Documentation**: Comments not matching current implementation
  - **Action Required**: Update to reflect current behavior
  - **Focus**: Parameter changes, return value changes, behavior modifications

* **Complex Logic Without Comments**: Non-obvious algorithms or business logic
  - **Action Required**: Add explanatory comments for complex sections
  - **Threshold**: Logic requiring more than 30 seconds to understand

== Refactoring Prioritization

**Overview**: Systematic prioritization ensures high-impact improvements are addressed first while maintaining code stability.

=== High Priority - Critical Issues

**Library and Dependency Issues**:

* Security vulnerabilities in dependencies
* Test/mock code in production files
* Heavy library usage for simple operations (jQuery for basic DOM)

**Code Organization Problems**:

* Mixed test and production code
* Large monolithic files (400+ lines)
* Circular dependencies
* Missing modularization for complex features

=== Medium Priority - Maintainability Issues

**Vanilla JavaScript Adoption**:

* jQuery/Cash usage for medium complexity operations
* Lodash usage for native array methods
* Legacy AJAX implementations

**Package Management**:

* Outdated dependencies without security issues
* Missing standard npm scripts
* Incorrect dependency categorization

**Code Quality**:

* Duplicate code blocks (10+ lines)
* Missing JSDoc for public APIs
* Poor separation of concerns

=== Low Priority - Code Style and Optimization

**Documentation Polish**:

* Missing JSDoc for private methods
* Verbose or redundant comments
* Minor formatting inconsistencies

**Minor Optimizations**:

* Small performance improvements
* Optional dependency updates
* Code style preferences

== Critical Constraints

**Overview**: Mandatory constraints that govern all code maintenance activities to ensure system stability and process integrity.

=== Functionality Preservation

**Strict Requirements**:

* **NO BEHAVIOR CHANGES** unless fixing confirmed bugs
* **Test Compatibility**: All existing tests must continue to pass
* **API Compatibility**: Maintain backward compatibility for public APIs
* **Browser Compatibility**: Maintain stated browser support levels

=== Safety Protocols

**Risk Mitigation**:

* **Incremental Changes**: Make small, focused refactoring commits
* **Test Coverage**: Maintain or improve test coverage
* **Build Verification**: Ensure build passes after each change
* **Dependency Locking**: Update package-lock.json with changes

== Maintenance Workflow

=== Analysis Phase

1. **Vanilla JavaScript Assessment**: Identify jQuery/library usage that can be replaced
2. **Test Code Contamination Check**: Find test/mock code in production files
3. **Modularization Review**: Identify monolithic files and duplication
4. **Package.json Audit**: Check dependencies, scripts, and security
5. **Documentation Review**: Assess JSDoc coverage and comment quality
6. **Code Organization Analysis**: Check module structure and dependencies
7. **Build System Verification**: Ensure all build scripts work correctly
8. **Prioritize Changes**: Apply refactoring prioritization framework
9. **Plan Module Order**: Dependencies first, then dependent modules

=== Standards Compliance Checklist

For each module/component, verify compliance with:

- [ ] **Vanilla JavaScript Usage**: Native APIs preferred over libraries
- [ ] **No Test Code**: Production files free of test/mock code
- [ ] **Proper Modularization**: Single responsibility, no unnecessary splitting
- [ ] **No Inappropriate Duplication**: Shared utilities for complex repeated code
- [ ] **Package.json Current**: Dependencies up-to-date and minimal
- [ ] **Security**: No unresolved vulnerabilities
- [ ] **JSDoc Coverage**: Public APIs documented
- [ ] **Comment Quality**: No trivial or outdated comments
- [ ] **Build Scripts**: All required npm scripts present
- [ ] **Code Organization**: Clear separation of concerns

=== Implementation Phase

1. **Apply Changes Incrementally**: Fix one category of issues at a time
2. **Run Format Check**: `npm run format:check` after changes
3. **Run Lint**: `npm run lint` after each change set
4. **Run Tests**: `npm test` after each significant change
5. **Check Coverage**: Ensure no coverage regression
6. **Update Dependencies**: One at a time with testing
7. **Commit Incrementally**: Small, focused commits per improvement category

=== Verification Phase

Following xref:task-completion-standards.adoc[Task Completion Standards]:

**Build and Quality Checks:**

1. **Format Verification**: `npm run format:check`
   * Purpose: Ensure consistent code formatting
   * Must pass before proceeding

2. **Lint Verification**: `npm run lint`
   * Purpose: Catch code quality issues
   * All violations must be resolved

3. **Test Execution**: `npm test`
   * Purpose: Verify functionality preserved
   * All tests must pass

4. **Coverage Analysis**: `npm run test:coverage`
   * Purpose: Ensure coverage maintained
   * No regression from baseline

5. **Security Audit**: `npm audit`
   * Purpose: Verify no new vulnerabilities
   * Document any that cannot be resolved

**Final Steps:**

1. **Build Verification**: `npm run build` (if applicable)
2. **Bundle Size Check**: Verify size impact of changes
3. **Manual Testing**: Test key functionality in browser
4. **Documentation Update**: Ensure README and docs current
5. **Final Commit**: Consolidate if needed, clear commit message

== Implementation Guidance

**Process Focus**: This document defines WHEN to apply refactoring actions. For detailed implementation guidance on HOW to implement these patterns, refer to:

* xref:../javascript/javascript-core-patterns.adoc[JavaScript Core Patterns] - Vanilla JS patterns and examples
* xref:../javascript/javascript-best-practices.adoc[JavaScript Best Practices] - Modern patterns and organization
* xref:../javascript/jsdoc-standards.adoc[JSDoc Standards] - Documentation implementation details
* xref:../javascript/javascript-development-standards.adoc[JavaScript Development Standards] - Package.json configuration

**Refactoring Categories**:
* **Library Migration**: When to replace jQuery/libraries with vanilla JS
* **Test Code Separation**: When to remove test code from production
* **Module Organization**: When to split or consolidate modules
* **Dependency Management**: When to update or remove packages
* **Documentation**: When to add, update, or remove comments

For complete quality verification, see xref:task-completion-standards.adoc[Task Completion Standards].

== See Also

**Core Documentation**:

* xref:../javascript/javascript-development-standards.adoc[JavaScript Development Standards] - Comprehensive standards
* xref:../javascript/javascript-core-patterns.adoc[JavaScript Core Patterns] - Language patterns
* xref:../javascript/jsdoc-standards.adoc[JSDoc Standards] - Documentation requirements
* xref:../javascript/linting-standards.adoc[Linting Standards] - Code quality rules

**Process Documentation**:

* xref:task-completion-standards.adoc[Task Completion Standards] - Quality verification
* xref:git-commit-standards.adoc[Git Commit Standards] - Commit standards
* xref:general.adoc[General Process Rules] - Process governance
* xref:javascript-test-maintenance.adoc[JavaScript Test Maintenance] - Test processes