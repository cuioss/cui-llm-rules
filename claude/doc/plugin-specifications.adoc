= Plugin Specifications
:toc: left
:toclevels: 3
:sectnums:

== Overview

Technical specifications for CUI marketplace bundles: manifests, directory structure, component formats.

== Directory Structure

=== Marketplace Layout

```
claude/marketplace/
├── .claude-plugin/
│   └── marketplace.json           # Marketplace manifest
├── bundles/                        # Workflow bundles
│   ├── cui-project-quality-gates/
│   │   ├── .claude-plugin/
│   │   │   └── plugin.json       # Bundle manifest
│   │   ├── README.md
│   │   ├── agents/               # .md files
│   │   ├── commands/             # .md files
│   │   └── skills/               # directories
│   └── cui-issue-implementation/
└── skills/                         # Standalone skills
    └── cui-java-core/
        ├── SKILL.md
        └── standards/
```

=== Component Formats

* **Commands**: Single `.md` files (NOT directories)
* **Agents**: Single `.md` files (NOT directories)
* **Skills**: Directories containing `SKILL.md`

== Manifests

=== marketplace.json

**Location**: `claude/marketplace/.claude-plugin/marketplace.json`

```json
{
  "name": "cui-development-standards",
  "owner": {"name": "CUI OSS Project"},
  "metadata": {
    "description": "CUI development standards marketplace",
    "version": "1.0.0"
  },
  "plugins": [
    {
      "name": "cui-java-skills",
      "description": "Java development standards",
      "source": "./",
      "skills": [
        "./skills/cui-java-core",
        "./skills/cui-java-unit-testing"
      ]
    },
    {
      "name": "cui-project-quality-gates",
      "description": "Build verification infrastructure",
      "source": "./bundles/cui-project-quality-gates"
    }
  ]
}
```

**Plugin config**:

* `name`: Kebab-case identifier (prefix `cui-`)
* `description`: One-sentence purpose
* `source`: Relative path to bundle root
* `skills`: Array of skill paths (for skill-only plugins)

=== plugin.json (Bundle)

**Location**: `bundles/{bundle-name}/.claude-plugin/plugin.json`

```json
{
  "name": "cui-project-quality-gates",
  "version": "1.0.0",
  "description": "Build verification and change management",
  "author": {"name": "CUI Team"},
  "agents": {
    "subdir": "agents",
    "files": ["maven-project-builder", "commit-changes"]
  },
  "commands": {
    "subdir": "commands",
    "files": ["commit-with-verification"]
  },
  "skills": {
    "subdir": "skills",
    "folders": ["cui-javadoc"]
  }
}
```

**Component fields**:

* `agents.files`: Agent filenames (without `.md`)
* `commands.files`: Command filenames (without `.md`)
* `skills.folders`: Skill directory names

== Components

=== Skills

**Structure**:
```
skills/skill-name/
├── SKILL.md          # Required: Workflow with YAML frontmatter
├── README.md         # Recommended: Human documentation
└── standards/        # Optional: Standards files
```

**SKILL.md frontmatter**:
```yaml
---
name: skill-name
description: When and why to use this skill
allowed-tools: [Read, Grep, Glob]
---
```

**Self-containment**: All file references must be internal (`standards/file.md`), no external paths (`../../../../`).

=== Agents

**Format**: Single `.md` file with YAML frontmatter

```yaml
---
name: agent-name
description: When to use with examples
tools: Read, Edit, Write, Bash, Skill
model: sonnet
color: green
---
```

**Structure**: See xref:agent-design-principles.adoc[Agent Design Principles]

=== Commands

**Format**: Single `.md` file with YAML frontmatter

```yaml
---
name: command-name
description: What this command does
---
```

**Invocation**: User types `/command-name`

== Installation

**Add marketplace**:
```bash
/plugin marketplace add cuioss/cui-llm-rules
```

**Install plugin**:
```bash
/plugin install cui-java-skills@cui-llm-rules
```

**Update marketplace**:
```bash
/plugin marketplace update cui-llm-rules
```

== Validation

**Verify bundle**:
```bash
/cui-diagnose-bundle {bundle-name}
```

**Verify agents**:
```bash
/cui-diagnose-agents
```

**Verify skills**:
```bash
/cui-diagnose-skills
```

== Common Issues

=== Missing YAML Frontmatter

**Error**: Component not recognized

**Fix**: Add frontmatter with `name` and `description`

```yaml
---
name: component-name
description: Component purpose
---
```

=== Wrong File Extension

**Error**: Commands/agents must be `.md` files

**Fix**: Rename `.txt` or extensionless files to `.md`

=== Directory vs File

**Error**: Commands and agents are files, not directories

**Fix**:
* ❌ `commands/my-command/command.md`
* ✅ `commands/my-command.md`

=== Absolute Paths

**Error**: Skills with external file references

**Fix**: Move external content into skill's `standards/` directory

* ❌ `Read: ../../../../standards/file.adoc`
* ✅ `Read: standards/file.md`

== Cross-References

* xref:plugin-architecture.adoc[Plugin Architecture]
* xref:bundling-architecture.adoc[Bundling Architecture]
* xref:agent-design-principles.adoc[Agent Design Principles]
* https://docs.claude.com/en/docs/claude-code/plugins[Claude Code Plugins]
