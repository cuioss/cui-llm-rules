= CUI Marketplace: Technical Specifications
:toc: left
:toclevels: 3
:sectnums:

== Overview

This document provides technical specifications for the CUI Development Standards Marketplace, including manifest formats, directory structure, component requirements, and bundle organization.

The marketplace follows a **bundle-based architecture** where related components (agents, commands, skills) are packaged together into cohesive plugins.

== Directory Structure

=== Repository Layout

[source]
----
/cui-llm-rules/
│
├── claude/marketplace/                # Marketplace root
│   │
│   ├── .claude-plugin/                # Marketplace definition
│   │   ├── marketplace.json           # Marketplace manifest
│   │   └── README.md                  # Marketplace documentation
│   │
│   ├── bundles/                       # Workflow bundles
│   │   ├── cui-project-quality-gates/
│   │   │   ├── .claude-plugin/
│   │   │   │   └── plugin.json
│   │   │   ├── README.md
│   │   │   ├── agents/
│   │   │   │   ├── maven-project-builder.md
│   │   │   │   └── commit-changes.md
│   │   │   └── skills/
│   │   │       └── cui-javadoc/
│   │   │           └── SKILL.md
│   │   │
│   │   ├── cui-issue-implementation/
│   │   ├── cui-pull-request-workflow/
│   │   ├── cui-documentation-standards/
│   │   ├── cui-plugin-development-tools/
│   │   └── cui-utility-commands/
│   │
│   ├── skills/                        # Standalone skill plugins
│   │   ├── cui-java-core/
│   │   │   ├── SKILL.md
│   │   │   └── standards/
│   │   ├── cui-java-unit-testing/
│   │   ├── cui-frontend-development/
│   │   ├── cui-documentation/
│   │   ├── cui-project-setup/
│   │   └── cui-requirements/
│   │
│   └── agents/                        # Standalone agents
│       └── research-best-practices.md
│
├── standards/                         # Source documentation (AsciiDoc)
│   ├── java/
│   ├── javascript/
│   ├── cdi/
│   ├── testing/
│   ├── documentation/
│   └── logging/
│
├── scripts/                           # Utility scripts
│   ├── asciidoc-validator.sh
│   └── verify-adoc-links.py
│
└── README.adoc
----

=== Directory Conventions

**Bundle Structure**:
```
bundles/{bundle-name}/
├── .claude-plugin/
│   └── plugin.json           # Required manifest
├── README.md                  # Bundle documentation
├── agents/                    # Agent components (optional)
│   ├── agent-1.md            # Single .md file per agent
│   └── agent-2.md
├── commands/                  # Command components (optional)
│   ├── command-1.md          # Single .md file per command
│   └── command-2.md
└── skills/                    # Skill components (optional)
    └── skill-name/           # Directory per skill
        ├── SKILL.md          # Required
        └── standards/        # Optional support files
```

**Critical Requirements**:
- Commands: Single `.md` files (NOT directories)
- Agents: Single `.md` files (NOT directories)
- Skills: Directories containing `SKILL.md` file

== Marketplace Manifest

=== marketplace.json Structure

**Location**: `claude/marketplace/.claude-plugin/marketplace.json`

[source,json]
----
{
  "name": "cui-development-standards",
  "owner": {
    "name": "CUI OSS Project"
  },
  "metadata": {
    "description": "Comprehensive marketplace of CUI development standards, skills, and best practices",
    "version": "1.0.0"
  },
  "plugins": [
    {
      "name": "cui-java-skills",
      "description": "Java development standards including core patterns, unit testing, JavaDoc, and CDI/Quarkus",
      "source": "./",
      "strict": false,
      "skills": [
        "./skills/cui-java-core",
        "./skills/cui-java-unit-testing",
        "./skills/cui-javadoc",
        "./skills/cui-java-cdi"
      ]
    },
    {
      "name": "cui-project-quality-gates",
      "description": "Build verification and change management infrastructure",
      "source": "./bundles/cui-project-quality-gates",
      "strict": false
    }
  ]
}
----

=== Field Specifications

**Root Level**:
- `name` (required): Marketplace identifier (kebab-case)
- `owner` (required): Object with `name` field (and optional `email`)
- `metadata` (required): Object with `description` and `version`
- `plugins` (required): Array of plugin configurations

**Plugin Configuration**:
- `name` (required): Plugin identifier (kebab-case, must start with `cui-` for CUI plugins)
- `description` (required): One-sentence explanation of plugin purpose
- `source` (required): Relative path to plugin root (e.g., `"./"` or `"./bundles/bundle-name"`)
- `strict` (optional): Validation mode (default: false)
- `skills` (optional): Array of skill directory paths (for skill-only plugins)

== Bundle Plugin Manifest

=== plugin.json Structure

**Location**: `bundles/{bundle-name}/.claude-plugin/plugin.json`

[source,json]
----
{
  "name": "cui-project-quality-gates",
  "version": "1.0.0",
  "description": "Build verification and change management infrastructure for CUI projects",
  "author": {
    "name": "CUI OSS Project",
    "email": "contact@cuioss.de"
  },
  "license": "Apache-2.0",
  "homepage": "https://github.com/cuioss/cui-llm-rules",
  "repository": {
    "type": "git",
    "url": "https://github.com/cuioss/cui-llm-rules.git"
  },
  "keywords": ["maven", "build", "commit", "quality", "verification"],
  "category": "development",
  "agents": [
    "./agents/maven-project-builder.md",
    "./agents/commit-changes.md"
  ],
  "commands": [
    "./commands/verify-build.md"
  ],
  "skills": [
    "./skills/cui-javadoc"
  ]
}
----

=== Field Specifications

==== Required Fields

[cols="1,2"]
|===
|Field |Description

|`name`
|Plugin identifier (kebab-case, must start with `cui-` for CUI bundles)

|`version`
|Semantic version (MAJOR.MINOR.PATCH format)

|`description`
|Clear one-sentence explanation of bundle purpose
|===

==== Recommended Fields

[cols="1,2"]
|===
|Field |Description

|`author`
|Object with `name` (required) and `email` (optional)

|`license`
|SPDX license identifier (e.g., "Apache-2.0", "MIT")

|`homepage`
|URL to documentation or project homepage

|`repository`
|Object with `type` (e.g., "git") and `url` fields

|`keywords`
|Array of 3-6 search terms for marketplace discovery

|`category`
|Plugin category (e.g., "development", "documentation", "quality")
|===

==== Component Fields

[cols="1,2"]
|===
|Field |Description

|`agents`
|Array of paths to agent `.md` files. **MUST include `.md` extension**. Example: `"./agents/maven-project-builder.md"`

|`commands`
|Array of paths to command `.md` files. **MUST include `.md` extension**. Example: `"./commands/verify-build.md"`

|`skills`
|Array of paths to skill directories (no `.md` extension). Directory must contain `SKILL.md`. Example: `"./skills/cui-javadoc"`
|===

==== Path Requirements

**Critical Rules**:
- All paths must be relative starting with `./`
- Agent paths: **MUST include `.md` file extension**
- Command paths: **MUST include `.md` file extension**
- Skill paths: Point to directories (no `.md` extension)
- No absolute paths (no `~/`, no `/Users/`, no `C:\`)

**Examples**:
```json
// ✅ CORRECT
"agents": ["./agents/maven-project-builder.md"]
"commands": ["./commands/verify-build.md"]
"skills": ["./skills/cui-javadoc"]

// ❌ INCORRECT
"agents": ["./agents/maven-project-builder"]        // Missing .md
"agents": ["./agents/maven-project-builder/AGENT.md"] // Wrong structure
"agents": ["~/git/project/agents/builder.md"]      // Absolute path
```

== Component Specifications

=== Skills

==== Directory Structure

[source]
----
skills/skill-name/
├── SKILL.md                  # Main skill definition (required)
├── README.md                 # Usage documentation (optional)
├── standards/                # Bundled standards (typical)
│   ├── standard1.adoc
│   └── standard2.adoc
├── scripts/                  # Helper scripts (optional)
└── templates/                # Code templates (optional)
----

==== SKILL.md Format

**YAML Frontmatter**:
[source,yaml]
----
---
name: cui-java-core
description: Core Java development standards for CUI projects including coding patterns, null safety, Lombok, modern features, DSL constants, and logging
allowed-tools: [Read, Edit, Write, Bash, Grep, Glob]
---
----

**Required Fields**:
- `name`: Skill identifier (kebab-case, max 64 chars, lowercase/numbers/hyphens only)
- `description`: Clear description that triggers auto-activation (max 1024 chars)

**Optional Fields**:
- `allowed-tools`: Array of tool names the skill can use

**Content Pattern**:
```markdown
# Skill Display Name

Brief description of what this skill provides.

## Workflow

### Step 1: Load Standards
**CRITICAL**: Load relevant standards files.

### Step 2: Extract Requirements
From loaded standards, extract and organize key requirements.

### Step 3: Execute Task
[Task-specific implementation]
```

=== Agents

==== File Format

**Location**: `agents/agent-name.md` or `bundles/{bundle}/agents/agent-name.md`

**Structure**: Single Markdown file (NOT a directory)

**Content Pattern**:
```markdown
# Agent Name

Agent purpose and description.

## Workflow

### Step 1: Analysis
[Analysis steps]

### Step 2: Implementation
[Implementation steps]

### Step 3: Output
[Output format]
```

**Note**: Agents do NOT use YAML frontmatter in the current implementation.

=== Commands

==== File Format

**Location**: `commands/command-name.md` or `bundles/{bundle}/commands/command-name.md`

**Structure**: Single Markdown file (NOT a directory)

**Invocation**: `/command-name` (filename without `.md` extension)

**Content Pattern**:
```markdown
# Command Name

You are a command that [purpose].

## Parameters
- `param1` (optional): Description
- `param2` (required): Description

## Process

1. Step 1
2. Step 2
3. Step 3

## Output

Expected output format and behavior.
```

**Note**: Commands do NOT use YAML frontmatter in the current implementation.

== Bundle Types

=== Workflow Bundles

**Purpose**: Package related agents, commands, and skills for specific workflows

**Examples**:
- `cui-project-quality-gates`: Build verification and commit management
- `cui-issue-implementation`: Issue-to-implementation workflow
- `cui-pull-request-workflow`: PR review and quality fixing

**Characteristics**:
- Contain multiple component types (agents + commands + skills)
- Components work together toward a common goal
- Installed as cohesive unit

=== Skill-Only Plugins

**Purpose**: Package domain-specific standards and knowledge

**Examples**:
- `cui-java-skills`: Java development standards
- `cui-frontend-skills`: Frontend development standards
- `cui-documentation-skills`: Documentation standards

**Characteristics**:
- Contain only skills (no agents or commands)
- Referenced by `skills` array in marketplace.json
- Use `"source": "./"` pointing to marketplace root

=== Utility Bundles

**Purpose**: Package standalone utility commands

**Example**:
- `cui-utility-commands`: Project setup, permissions, diagnostics utilities

**Characteristics**:
- Primarily commands (may have some agents)
- General-purpose utilities usable across projects
- Don't form cohesive workflow like other bundles

== Installation

=== Adding Marketplace

```bash
# From GitHub repository
/plugin marketplace add cuioss/cui-llm-rules/claude/marketplace

# From local path
/plugin marketplace add file:///Users/oliver/git/cui-llm-rules/claude/marketplace
```

=== Installing Plugins

```bash
# Install specific plugin from marketplace
/plugin install cui-project-quality-gates@cui-development-standards

# Browse and install interactively
/plugin
```

=== Project Auto-Configuration

**File**: `.claude/settings.json`

[source,json]
----
{
  "plugins": {
    "marketplaces": ["cuioss/cui-llm-rules/claude/marketplace"],
    "installed": [
      "cui-project-quality-gates@cui-development-standards",
      "cui-java-skills@cui-development-standards"
    ]
  }
}
----

== Updates

=== Updating Marketplace

```bash
# Update all plugins in marketplace
/plugin marketplace update cui-development-standards
```

**Note**: Individual plugin updates are not supported. All plugins in marketplace update together.

=== Version Management

Keep versions synchronized:
1. `bundles/{bundle}/.claude-plugin/plugin.json` → `version` field
2. `claude/marketplace/.claude-plugin/marketplace.json` → `metadata.version` field
3. Git tags → `vX.Y.Z` format

```bash
# Create release
git tag v1.0.0
git push origin v1.0.0
```

== Verification

=== Marketplace Verification

```bash
# List configured marketplaces
/plugin marketplace list

# Check installation
ls -la ~/.claude/plugins/marketplaces/cui-development-standards/
```

=== Component Verification

```bash
# Check installed plugins
/plugin

# List available commands
/help

# Verify specific command exists
/build-and-verify --help
```

=== Skills Verification

Skills auto-activate based on context. Verify by:

1. Create test file matching skill domain (e.g., Java file for cui-java-core)
2. Request relevant task (e.g., code review)
3. Check that Claude references standards from skill

== Path Resolution

=== Relative Paths

All paths in manifests use **relative paths from the file's location**:

**In marketplace.json**:
- `"source": "./"` → Points to `claude/marketplace/`
- `"source": "./bundles/cui-project-quality-gates"` → Points to `claude/marketplace/bundles/cui-project-quality-gates/`
- `"skills": ["./skills/cui-java-core"]` → Points to `claude/marketplace/skills/cui-java-core/`

**In bundle plugin.json**:
- `"agents": ["./agents/maven-project-builder.md"]` → Points to `bundles/{bundle}/agents/maven-project-builder.md`
- `"skills": ["./skills/cui-javadoc"]` → Points to `bundles/{bundle}/skills/cui-javadoc/`

=== Cross-Bundle References

Components can reference other bundles using relative paths:

```yaml
# In command file
sub_agents:
  - path: ../bundles/cui-project-quality-gates/agents/maven-project-builder.md
```

**Requirements**:
- Must include `.md` extension for agents and commands
- Must use relative paths from current file location
- Must navigate through bundle structure correctly

== Common Issues

=== Missing .md Extensions

**Problem**: Component paths in plugin.json without `.md` extension

**Symptom**: Components not loading or errors during plugin installation

**Solution**: Add `.md` extension to all agent and command paths
```json
// ❌ WRONG
"agents": ["./agents/maven-project-builder"]

// ✅ CORRECT
"agents": ["./agents/maven-project-builder.md"]
```

=== Directory Structure Mistakes

**Problem**: Agents or commands as directories instead of single files

**Symptom**: Multiple components appear (e.g., `:COMMAND` and `:README` suffixes)

**Solution**: Convert directories to single `.md` files
```
// ❌ WRONG
agents/
└── maven-project-builder/
    ├── AGENT.md
    └── README.md

// ✅ CORRECT
agents/
└── maven-project-builder.md
```

=== Absolute Paths

**Problem**: Using absolute paths in manifests

**Symptom**: Paths break when repository is cloned to different location

**Solution**: Always use relative paths starting with `./`
```json
// ❌ WRONG
"agents": ["/Users/oliver/git/cui-llm-rules/claude/marketplace/agents/builder.md"]

// ✅ CORRECT
"agents": ["./agents/builder.md"]
```

=== Missing commands Field

**Problem**: Bundle has command files but no `commands` field in plugin.json

**Symptom**: Commands not registered and not discoverable

**Solution**: Add `commands` array to plugin.json listing all command files
```json
{
  "name": "cui-utility-commands",
  "commands": [
    "./commands/build-and-verify.md",
    "./commands/setup-project-permissions.md"
  ]
}
```

== Cross-References

* **Bundling Architecture**: xref:bundling-architecture.adoc[Bundling Architecture]
* **Plugin Architecture**: xref:plugin-architecture.adoc[Plugin Architecture]
* **Agent Design**: xref:agent-design-principles.adoc[Agent Design Principles]
* **Official Docs**: https://docs.claude.com/en/docs/claude-code/plugins
