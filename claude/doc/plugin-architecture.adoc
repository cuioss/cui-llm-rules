= Plugin Architecture
:toc: left
:toclevels: 3
:sectnums:

== Overview

CUI standards plugin provides development standards, skills, agents, and commands via Claude Code's plugin marketplace.

**Platform**: Claude Code CLI (terminal and VS Code)

**Installation**:
```bash
/plugin marketplace add cuioss/cui-llm-rules
/plugin install cui-standards@cui-llm-rules
```

== Three-Layer Architecture

Skills (knowledge) → Agents (executors) → Commands (user utilities)

**Layer Rules**:

* Skills are self-contained (all content in `standards/` directory)
* Agents use Skills via `Skill:` invocations (not direct file reads)
* Commands orchestrate agents and provide user interaction

**Details**: See `cui-marketplace-architecture` skill for complete architecture rules, validation patterns, and reference standards.

== Design Decisions

=== 1. Plugin Distribution

**Approach**: Single-command marketplace installation

**Benefits**:

* Automatic component discovery
* Built-in version management
* No manual file synchronization
* Cross-project availability

=== 2. Self-Contained Skills

**Rule**: Skills contain all standards in their own `standards/` directory.

**Requirement**: Skills must work when distributed independently (no external file dependencies).

**Validation**: See `cui-marketplace-architecture` skill.

=== 3. Skill Loading in Agents

**Pattern**: Agents load standards dynamically via Skill tool

```markdown
## SKILLS USED
- **cui-java-core**: Java standards
  - When activated: Step 0

## WORKFLOW
### Step 0: Activate Skills
Skill: cui-java-core
```

**Benefits**:

* Modularity (skills reusable across agents)
* Maintainability (single source of truth)
* Always current (loads from source)

=== 4. Global Installation

**Location**: `~/.claude/plugins/marketplaces/cui-llm-rules/`

**Override Hierarchy**:
```
1. Project .claude/      (highest priority)
2. User ~/.claude/
3. Plugin-provided       (lowest priority)
```

**Benefit**: Projects override specific components while using global baseline.

== Loading Model

**Skills** (progressive disclosure):

1. Startup: Description loaded (~30 tokens)
2. Context match: Claude determines relevance
3. Invocation: `Skill:` loads SKILL.md
4. Execution: Skill reads its own standards files

**Agents**:

1. Startup: Frontmatter metadata
2. Invocation: Full agent.md loaded
3. Step 0: Loads skills via Skill tool

== Version Management

**Updates**:
```bash
/plugin marketplace update cui-llm-rules
```

**Versioning**: Semantic (MAJOR.MINOR.PATCH)

**Sync across**:

* `.claude-plugin/plugin.json`
* `marketplace.json`
* Git tags (`vX.Y.Z`)

== References

* Claude Code Plugins: https://docs.claude.com/en/docs/claude-code/plugins
* Plugin Marketplaces: https://docs.claude.com/en/docs/claude-code/plugin-marketplaces
* xref:plugin-specifications.adoc[Plugin Specifications]
* xref:bundling-architecture.adoc[Bundling Architecture]
* xref:agent-design-principles.adoc[Agent Design Principles]
