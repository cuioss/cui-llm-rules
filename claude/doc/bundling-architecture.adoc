= Bundling Architecture
:toc: left
:toclevels: 3
:sectnums:

== Overview

Bundles organize related agents, commands, and skills into cohesive functional units installed as single packages.

**Purpose**: Group components that serve common workflows or domains.

**Distribution**: Via plugin marketplace at `claude/marketplace/bundles/`

== Bundle Patterns

The marketplace implements 5 bundle types:

=== 1. Quality Gates

**Bundle**: `cui-project-quality-gates`

**Purpose**: Build verification and change management

**Components**: maven-project-builder agent, commit-changes agent, cui-javadoc skill

**Rationale**: Build → verify → commit is atomic workflow (100% co-occurrence)

=== 2. Issue Implementation

**Bundle**: `cui-issue-implementation`

**Purpose**: Structured issue implementation workflow

**Components**: task-reviewer, task-breakdown-agent, task-executor agents; /cui-implement-task command

**Rationale**: Sequential workflow: review → plan → execute

=== 3. Pull Request Workflow

**Bundle**: `cui-pull-request-workflow`

**Purpose**: PR review response and quality fixing

**Components**: pr-review-responder, pr-quality-fixer agents; /cui-handle-pull-request command

**Rationale**: PR-specific workflow with high coupling

=== 4. Documentation Standards

**Bundle**: `cui-documentation-standards`

**Purpose**: AsciiDoc documentation enforcement

**Components**: asciidoc-reviewer agent, cui-documentation skill, /cui-review-technical-docs command

**Rationale**: Domain-specific bundle where agent loads skill for standards

=== 5. Plugin Development Tools

**Bundle**: `cui-plugin-development-tools`

**Purpose**: Plugin development toolchain

**Components**: /cui-create-agent, /cui-create-command, /cui-diagnose-* commands

**Rationale**: Complete development lifecycle tooling

== Design Principles

**See**: `cui-marketplace-architecture` skill for complete bundle architecture rules

**Key principles**:

* **Component Count**: 2-8 per bundle (avg: 3.8)
* **Functional Cohesion**: Group by workflow/domain, not component type
* **Common Closure**: Components that change together belong together
* **Co-occurrence**: Bundle if used together >70% of time

**Examples**:

* ✅ "PR Workflow" bundle (agents + commands for PR handling)
* ✅ "Documentation Standards" (agent + skill + command for docs)
* ❌ "All Agents Bundle" (no functional cohesion)

== Structure

=== Directory Layout

```
bundles/{bundle-name}/
├── .claude-plugin/
│   └── plugin.json           # Required manifest
├── README.md                  # Required documentation
├── agents/                    # .md files (optional)
├── commands/                  # .md files (optional)
└── skills/                    # directories (optional)
```

**File requirements**:

* Commands: Single `.md` files (NOT directories)
* Agents: Single `.md` files (NOT directories)
* Skills: Directories containing `SKILL.md`

=== Manifest Format

**Location**: `.claude-plugin/plugin.json`

```json
{
  "name": "cui-project-quality-gates",
  "version": "1.0.0",
  "description": "Build verification and change management",
  "author": {"name": "CUI OSS Project"},
  "agents": [
    "./agents/maven-project-builder.md",
    "./agents/commit-changes.md"
  ],
  "commands": [
    "./commands/cui-verify-build.md"
  ],
  "skills": [
    "./skills/cui-javadoc"
  ]
}
```

**Required**: name, version, description

**Component paths**:

* Agents/commands: Include `.md` extension
* Skills: Directory path (no extension)
* All paths start with `./`

=== README Format

**Required sections**:

1. Purpose (1-2 sentences)
2. Components Included (list with descriptions)
3. Installation (`/plugin install {bundle-name}`)
4. Usage Examples (2+ scenarios)
5. Dependencies (if any)

== Installation

**Add marketplace**:
```bash
/plugin marketplace add cuioss/cui-llm-rules
```

**Install bundle**:
```bash
/plugin install cui-project-quality-gates@cui-llm-rules
```

**Update**:
```bash
/plugin marketplace update cui-llm-rules
```

== Creating Bundles

**Decision process**:

1. **Functional cohesion**: Single task/domain?
   * NO → Keep separate
   * YES → Continue

2. **Co-occurrence**: Used together >70%?
   * NO → Keep separate
   * YES → Continue

3. **Common closure**: Change together?
   * NO → Keep separate
   * YES → Continue

4. **Component count**: 2-8 components?
   * NO → Split or keep separate
   * YES → Bundle

**Registration**: Add entry to `marketplace.json`:

```json
{
  "name": "cui-bundle-name",
  "description": "Bundle purpose",
  "source": "./bundles/bundle-name"
}
```

== Common Issues

=== Command/Agent Directory Structure

**Error**: Creating directories instead of single files

**Wrong**:
```
commands/
└── cui-build/          ❌ Directory
    └── COMMAND.md     ❌ Exposed as ":COMMAND"
```

**Correct**:
```
commands/
└── cui-build.md        ✅ Single file
```

**Consequence**: Directory structure creates duplicate listings with `:COMMAND` and `:README` suffixes

=== Missing .md Extension

**Error**: Manifest paths without `.md`

**Wrong**: `"./agents/maven-builder"`

**Correct**: `"./agents/maven-builder.md"`

=== Absolute Paths

**Error**: Using absolute or user-specific paths

**Wrong**: `~/git/cui-llm-rules/...`

**Correct**: `./agents/...` (relative from bundle root)

== Cross-References

* xref:plugin-architecture.adoc[Plugin Architecture]
* xref:plugin-specifications.adoc[Plugin Specifications]
* xref:agent-design-principles.adoc[Agent Design Principles]
* `cui-marketplace-architecture` skill - Complete bundle rules
