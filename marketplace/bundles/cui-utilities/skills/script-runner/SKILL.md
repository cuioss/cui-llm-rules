---
name: script-runner
description: Resolves and executes skill scripts using portable notation. Use when skills need to run bundled scripts - handles path resolution from bundle:skill/scripts/name notation to absolute paths, with lazy discovery and permission generation.
allowed-tools:
  - Read
  - Write
  - Glob
  - Skill
  - AskUserQuestion
---

# Script Runner Skill

Resolves skill script paths using portable notation and manages script permissions.

## Problem

Claude Code skills cannot reliably execute bundled scripts because:
- Relative paths like `scripts/foo.sh` resolve from current working directory, not skill directory
- Absolute paths are machine-specific and not portable
- The "Base directory" provided when a skill loads is not automatically used for Bash path resolution

## Solution

This skill provides:
1. **Portable notation**: `bundle:skill/scripts/name.ext` format
2. **Path resolution**: Converts notation to absolute paths
3. **Lazy discovery**: Auto-discovers on first use or when cache is stale
4. **Permission generation**: Creates ready-to-use permission patterns

## Notation Format

```
bundle:skill/scripts/name.ext

Examples:
- cui-plugin-development-tools:marketplace-inventory/scripts/scan-marketplace-inventory.sh
- cui-utilities:permission-management/scripts/generate-permission-wildcards.py
```

See `references/notation-spec.md` for full specification.

## Storage

Script mappings and permissions are stored in `.claude/scripts.local.json`:
- Machine-specific (absolute paths)
- Must be added to `.gitignore`
- Auto-generated by Discover workflow

## Workflows

### Workflow: Resolve

Resolves a script notation to its absolute path. Triggers discovery if cache is missing or stale.

#### Input

- `notation`: Script notation string (e.g., `cui-utilities:permission-management/scripts/generate-permission-wildcards.py`)

#### Steps

1. **Try cache lookup**:
   ```
   Read .claude/scripts.local.json
   ```

2. **If cache exists**: Look up notation in `scripts` object
   - If found: Return the `absolute` path
   - If not found: Proceed to step 3

3. **If cache missing OR notation not found**: Trigger Discover workflow
   ```
   Execute Discover workflow (below)
   ```

4. **Retry lookup**: Read updated cache and return absolute path

5. **If still not found**: Return error with available notations

#### Output

Return the absolute path string for use in Bash commands.

---

### Workflow: Discover

Discovers all skill scripts from installed plugins and generates the scripts cache.

#### Steps

1. **Invoke marketplace-inventory skill**:
   ```
   Skill: cui-plugin-development-tools:marketplace-inventory
   ```

   This returns JSON with all bundles, skills, and scripts.

2. **Parse inventory for scripts**:

   For each bundle in inventory:
   - Get bundle name and install path
   - For each skill with scripts:
     - Build notation: `{bundle}:{skill}/scripts/{script-name}`
     - Record absolute path: `{install-path}/skills/{skill}/scripts/{script-name}`
     - Determine type: `bash` for `.sh`, `python3` for `.py`

3. **Generate permission patterns**:

   For each skill with scripts, generate ONE permission per skill directory:
   - Bash scripts: `Bash(bash {install-path}/skills/{skill}/scripts/*.sh:*)`
   - Python scripts: `Bash(python3 {install-path}/skills/{skill}/scripts/*.py:*)`

4. **Identify marketplace**:

   Extract marketplace name from plugin keys (e.g., `cui-java-expert@cui-development-standards` â†’ `cui-development-standards`)

5. **Write scripts.local.json**:
   ```
   Write .claude/scripts.local.json
   ```

   Format:
   ```json
   {
     "version": 1,
     "discovered_at": "2025-11-24T10:30:00Z",
     "marketplace": "cui-development-standards",
     "scripts": {
       "bundle:skill/scripts/name.sh": {
         "absolute": "/full/path/to/scripts/name.sh",
         "type": "bash"
       }
     },
     "permissions": [
       "Bash(bash /full/path/to/skill/scripts/*.sh:*)",
       "Bash(python3 /full/path/to/skill/scripts/*.py:*)"
     ]
   }
   ```

6. **Check .gitignore**:
   ```
   Read .gitignore
   ```

   If `scripts.local.json` pattern is NOT present:
   ```
   AskUserQuestion: "Add .claude/scripts.local.json to .gitignore? (Required - contains machine-specific paths)"
   ```

   If user confirms, append to .gitignore:
   ```
   .claude/scripts.local.json
   ```

#### Output

Confirmation message with statistics:
- Scripts discovered: N
- Permissions generated: M
- Cache location: .claude/scripts.local.json

---

## Usage in Other Skills

Skills that need to run scripts should:

1. **Document the notation** in their SKILL.md:
   ```markdown
   Script: `cui-plugin-development-tools:marketplace-inventory/scripts/scan-marketplace-inventory.sh`
   ```

2. **Invoke script-runner to resolve**:
   ```
   Skill: cui-utilities:script-runner
   Resolve: cui-plugin-development-tools:marketplace-inventory/scripts/scan-marketplace-inventory.sh
   ```

3. **Use the returned absolute path**:
   ```bash
   bash {resolved_path} --scope marketplace
   ```

Or simply read `.claude/scripts.local.json` directly and use the absolute path.

## Integration with tools-setup-project-permissions

The `permissions` array in `scripts.local.json` is ready to be copied to `~/.claude/settings.json`.

The `tools-setup-project-permissions` command:
1. Reads `.claude/scripts.local.json`
2. Removes old script permissions for the marketplace
3. Adds new permissions from the `permissions` array

## References

- `references/notation-spec.md` - Full notation specification
